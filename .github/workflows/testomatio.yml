name: Playwright Tests CI

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:
    inputs:
      grep:
        description: 'Тести для фільтрації'
        required: false
        default: ''
      testomatio:
        description: 'ID запуску в Testomat'
        required: false

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Use Node.js 20.x
      uses: actions/setup-node@v4
      with:
        node-version: 20.x
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Install Playwright Browsers
      # Цей крок обов'язковий, щоб не було помилки "Executable not found"
      run: npx playwright install --with-deps

    - name: Run Playwright tests
      # Ми запускаємо тест напряму, ігноруючи npm test, щоб передати grep
      run: npx playwright test --grep "${{ github.event.inputs.grep }}"
      env:
        # Переконайтеся, що цей секрет додано в Settings -> Secrets вашого репо
        TESTOMATIO: ${{ secrets.TESTOMATIO }}
        TESTOMATIO_RUN: ${{ github.event.inputs.testomatio }}
